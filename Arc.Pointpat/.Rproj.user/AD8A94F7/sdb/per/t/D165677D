{
    "contents" : "#' Developing a script that enables a tool to run the point pattern analysis - estimating density and simulating point pattern.\n#'\n#' This script function converts the input point feature into a point pattern dataset and estimates the density of the converted point pattern\n#' and simulates a point pattern based on the estimated density upon being run with the corresponding ArcGIS script tool.\n#'\n#' @param in_params - input parameter containing the point feature.\n#' @param out_params - output parameter containing the outputs for the estimated density and the simulated point pattern as the shapefiles.\n#'\n#' @note The in_params parameter includes the \\emph{input point feature, input boundary, and the band width for the density}\n#' @note The out_params parameter includes the return values of \\emph{output_feature1}, which is the density and \\emph{output_feature2}, which is the simulated point pattern.\n#' @import sp\n#' @importFrom raster raster\n#' @import maptools\n#' @import arcgisbinding\n#' @import spatstat\n#'\n#' @return output_feature1 - \\code{\\link[spatstat]{density.ppp}} Output krige shapefile that contains the predictions of the values of unsampled locations from the Prediction_location dataset.\n#' @return output_feature2 - \\code{\\link[spatstat]{simulate.ppm}} Output variance provides how far the values are deviated from the other and the mean and exports the output as a pdf file.\n#' @author Edzer Pebesma, Shankarlingam Sundaresan\n#' @details This script function estimated the density of the point pattern using the kernel density estimation methodology using the kernel smoothed intensity function and simulates another point pattern by fitting a point pattern model.\n#' @export\n#' @seealso \\code{\\link{spatstat}} , \\code{\\link{arcgisbinding}}\n#'\n\n\n#Point pattern densities - estimation of densities and simulation of point pattern using spatstat\n\ntool_exec <- function(in_params, out_params)\n{\n  as.ppp = NULL\n  density.ppp = NULL\n  ppm = NULL\n  unmark = NULL\n  arc.open = NULL\n  arc.select =NULL\n  arc.data2sp = NULL\n  raster = NULL\n  SpatialPointsDataFrame = NULL\n  arc.write = NULL\n  rm(list=ls())\n\n  if (!requireNamespace(\"sp\", quietly = T))\n    install.packages(\"sp\")\n  if (!requireNamespace(\"spatstat\",quietly = T))\n    install.packages(\"spatstat\")\n  if (!requireNamespace(\"maptools\",quietly = T))\n    install.packages(\"maptools\")\n  if (!requireNamespace(\"raster\",quietly = T))\n    install.packages(\"raster\")\n\n  ##Declaring the inputs and Output\n  input_feature = in_params[[1]]\n  input_boundary = in_params[[2]]\n  BWidth = in_params[[3]]\n  output_feature1 = out_params[[1]]\n  output_feature2 = out_params[[2]]\n\n  ## Reading the input in Arcgis\n  d = arc.open(input_feature)\n  dat = arc.select(d, names(d@fields))\n  dat.2 = arc.data2sp(dat)\n\n  #reading boudary input\n  b = arc.open(input_boundary)\n  b1 = arc.select(b,names(b@fields))\n  b2 = arc.data2sp(b1)\n\n  ##converting boundary into owin object\n  b.win = as.owin(b2)\n\n  ### Converting the class\n  if(!is.null(input_boundary))\n  {\n    pts = coordinates(dat.2)\n    dat.ppp = ppp(pts[,1],pts[,2],window = b.win)\n  }\n  else\n  {\n    dat.ppp = as.ppp(dat.2)\n  }\n\n  print(dat.ppp)\n\n  # Estimating Density\n  d1= density.ppp(dat.ppp, sigma = BWidth)\n  print(d1)\n  r = raster(d1)\n\n  ## Converting to SP class\n  patternDensity = as(r, \"SpatialPolygonsDataFrame\")\n\n  ##Simulating point pattern with the density as reference\n  fitDensity = ppm(unmark(dat.ppp),~d1)\n  simDensity = simulate(fitDensity)\n  print(simDensity)\n\n  ##converting to dataframe\n  simDensDataF = as.data.frame(simDensity)\n  spdfSim = SpatialPointsDataFrame(simDensDataF,simDensDataF)\n  #### Write Output ####\n\n  message(\"...write output...\")\n  arc.write(output_feature1,patternDensity)\n  arc.write(output_feature2,spdfSim, shape_info = d@shapeinfo)\n  message(\"...done...almost...\")\n  return(out_params)\n}\n",
    "created" : 1460044037968.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2524313645",
    "id" : "D165677D",
    "lastKnownWriteTime" : 1460044209,
    "path" : "C:/Users/Shankar/Desktop/SEM-2/Githb/R_GIS/Arc.Pointpat/R/PointPattern.R",
    "project_path" : "R/PointPattern.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}